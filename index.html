<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Draw Dash Bust</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/phaser.min.js"></script>
    <style>
        /* 补充规则弹窗的内部样式 */
        .rules-container {
            text-align: left;
            padding: 0 10px;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            max-height: 60vh; /* 防止内容过长溢出 */
            overflow-y: auto; /* 超出可滚动 */
        }
        .rules-container h3 {
            color: #d84315;
            border-bottom: 2px solid #ffab91;
            padding-bottom: 5px;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .rules-container ul {
            padding-left: 20px;
            margin: 0;
        }
        .rules-container li {
            margin-bottom: 8px;
        }
        .item-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            margin-right: 5px;
        }
        .tag-def { background-color: #4caf50; } /* 防御 */
        .tag-atk { background-color: #f44336; } /* 攻击 */
        .tag-bonus { background-color: #ff9800; } /* 奖励 */
    </style>
</head>
<body>
<div id="game-container"></div>

<div id="start-screen">
    <div class="title-container">
        <div class="title-group">
            <div class="cn-text">抽!</div>
            <div class="en-text">DRAW</div>
        </div>
        <div class="title-group">
            <div class="cn-text">跑!</div>
            <div class="en-text">DASH</div>
        </div>
        <div class="title-group">
            <div class="cn-text">爆!</div>
            <div class="en-text">BUST</div>
        </div>
    </div>

    <div class="menu-buttons">
        <button id="btn-start" class="menu-btn start-btn">开始游戏</button>
        <button id="btn-rules" class="menu-btn rules-btn">规则介绍</button>
    </div>

    <div class="footer-text">v1.0.0 by PikaZHJ</div>
</div>

<div id="setup-screen" class="hidden">
    <h2 class="setup-title">选择电脑玩家数量</h2>

    <div class="counter-container">
        <button id="btn-minus" class="counter-btn">-</button>
        <span id="ai-count-display">3</span>
        <button id="btn-plus" class="counter-btn">+</button>
    </div>

    <button id="btn-launch" class="menu-btn start-btn">进入游戏</button>
    <button id="btn-back" class="text-btn">返回</button>
</div>

<div id="rules-modal" class="hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>游戏规则说明</h2>
            <button id="btn-close-rules" class="close-btn">×</button>
        </div>
        <div class="modal-body">
            <div class="rules-container">
                <section>
                    <h3>🏆 胜利条件</h3>
                    <p>通过抽牌累积点数，棋子在棋盘上移动。率先累积总分达到 <strong>200分</strong> 的玩家获胜。</p>
                </section>

                <section>
                    <h3>🎲 基础玩法</h3>
                    <ul>
                        <li><strong>回合流程</strong>：轮到你时，可以选择【抽牌】或【放弃】。</li>
                        <li><strong>抽牌</strong>：
                            <ul>
                                <li><strong>数字牌</strong>：获得对应分数，棋子前进对应步数。</li>
                                <li><strong>功能牌</strong>：触发特殊效果（如冻结对手、翻倍分数）。</li>
                            </ul>
                        </li>
                        <li><strong>💥 爆牌 (BUST)</strong>：如果你抽到的数字牌与你<strong>本轮手牌</strong>中已有的数字重复，则发生爆炸！本轮得分归零，强制结束回合。</li>
                        <li><strong>🔒 放弃 (BANK)</strong>：如果你觉得风险太高，可以选择“放弃”。本轮当前得分将安全计入总分，并结束回合。</li>
                    </ul>
                </section>

                <section>
                    <h3>🎁 道具获取与特殊格</h3>
                    <p>棋盘上设有金色的<strong>特殊奖励格</strong>（第 1, 6, 12, 18 格）。</p>
                    <ul>
                        <li><strong>获取方式</strong>：当你的棋子移动后<strong>刚好停留</strong>在特殊格上时，系统会免费赠送一张<strong>功能卡</strong>或<strong>防御道具</strong>。</li>
                        <li><strong>使用方式</strong>：
                            <ul>
                                <li><strong>主动卡</strong>（如冻结）：抽到即刻触发，需选择目标。</li>
                                <li><strong>被动道具</strong>（如复活）：自动存入底部道具栏，在关键时刻（如快爆牌时）自动触发。</li>
                            </ul>
                        </li>
                    </ul>
                </section>

                <section>
                    <h3>🃏 道具图鉴</h3>
                    <ul>
                        <li><span class="item-tag tag-def">复</span> <strong>第二次机会</strong>：被动神器。当你抽到重复数字即将爆牌时，自动消耗此道具抵消该卡，保住分数并安全结束回合。</li>
                        <li><span class="item-tag tag-def">闪</span> <strong>快闪</strong>：被动防御。当对手对你使用“冻结”等技能时，自动消耗此道具进行格挡。</li>
                        <li><span class="item-tag tag-atk">冻</span> <strong>冻结</strong>：指定一名对手，使其下回合无法行动（跳过）。</li>
                        <li><span class="item-tag tag-atk">三</span> <strong>翻3张</strong>：指定一名对手（或自己），强制其连续快速抽取3张牌，极大概率导致其爆牌。</li>
                        <li><span class="item-tag tag-bonus">胆</span> <strong>试胆竞速</strong>：发起 1v1 对决！双方从牌库盲抽，比拼点数总和，赢家获得额外奖励分。</li>
                        <li><span class="item-tag tag-bonus">双</span> <strong>无双模式</strong>：本轮后续每次点击“抽牌”都会一次性抽取 2 张，高风险高回报！</li>
                    </ul>
                </section>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { launchGame } from './js/main.js';

    // UI 元素
    const startScreen = document.getElementById('start-screen');
    const setupScreen = document.getElementById('setup-screen');
    const rulesModal = document.getElementById('rules-modal');

    const btnStart = document.getElementById('btn-start');
    const btnRules = document.getElementById('btn-rules');
    const btnCloseRules = document.getElementById('btn-close-rules');

    const btnMinus = document.getElementById('btn-minus');
    const btnPlus = document.getElementById('btn-plus');
    const countDisplay = document.getElementById('ai-count-display');
    const btnLaunch = document.getElementById('btn-launch');
    const btnBack = document.getElementById('btn-back');

    // 状态变量
    let aiCount = 3; // 默认3个电脑

    // --- 事件监听 ---

    // 1. 点击“开始游戏” -> 跳转到设置页
    btnStart.addEventListener('click', () => {
        startScreen.classList.add('hidden');
        setupScreen.classList.remove('hidden');
    });

    // 2. 计数器逻辑
    btnMinus.addEventListener('click', () => {
        if (aiCount > 1) {
            aiCount--;
            updateDisplay();
        }
    });

    btnPlus.addEventListener('click', () => {
        if (aiCount < 5) {
            aiCount++;
            updateDisplay();
        }
    });

    function updateDisplay() {
        countDisplay.textContent = aiCount;
        // 简单的视觉反馈：达到极限时变灰
        btnMinus.style.opacity = aiCount === 1 ? '0.3' : '1';
        btnPlus.style.opacity = aiCount === 5 ? '0.3' : '1';
    }

    // 3. 点击“进入游戏” -> 启动 Phaser
    btnLaunch.addEventListener('click', () => {
        setupScreen.classList.add('hidden');
        // 调用 main.js 里的启动函数，传入电脑数量
        launchGame(aiCount);
    });

    // 4. 返回主菜单
    btnBack.addEventListener('click', () => {
        setupScreen.classList.add('hidden');
        startScreen.classList.remove('hidden');
    });

    // 5. 规则相关
    btnRules.addEventListener('click', () => rulesModal.classList.remove('hidden'));
    btnCloseRules.addEventListener('click', () => rulesModal.classList.add('hidden'));

    // 初始化显示
    updateDisplay();
</script>
</body>
</html>